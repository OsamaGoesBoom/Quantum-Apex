<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <title>QUANTUM APEX // SECURE_ACCESS</title>
    <style>
        :root { 
            --bg: #010409; --panel: #0d1117; --border: #30363d;
            --cyan: #58a6ff; --magenta: #bc8cff; --green: #3fb950; --red: #f85149; --gold: #d29922;
            --admin: #f0883e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; }
        body { background: var(--bg); color: #c9d1d9; height: 100vh; overflow: hidden; font-size: 13px; }

        /* ADMIN PANEL STYLES */
        #adminPanel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 400px; background: #0d1117; border: 2px solid var(--admin);
            border-radius: 8px; z-index: 3000; padding: 20px; display: none;
            box-shadow: 0 0 20px rgba(240, 136, 62, 0.3);
        }
        .admin-title { color: var(--admin); font-weight: bold; margin-bottom: 15px; text-align: center; font-size: 16px; letter-spacing: 2px; }
        .admin-row { margin-bottom: 10px; }
        .admin-label { display: block; font-size: 10px; color: #8b949e; margin-bottom: 4px; }

        /* AUTHENTICATION OVERLAY */
        .auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .auth-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 30px; width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); }
        .auth-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: #8b949e; transition: 0.3s; }
        .tab.active { color: var(--cyan); border-bottom: 2px solid var(--cyan); font-weight: bold; }

        /* GAME INTERFACE */
        .app { display: grid; grid-template-columns: 280px 1fr 300px; grid-template-rows: 60px 1fr 40px; height: 100vh; gap: 8px; padding: 8px; visibility: hidden; }
        .box { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; padding: 12px; display: flex; flex-direction: column; overflow: hidden; }
        
        .btn { padding: 10px 15px; border: 1px solid var(--border); border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; background: #21262d; color: #c9d1d9; width: 100%; margin: 5px 0; }
        .btn:hover { background: #30363d; border-color: #8b949e; }
        .btn-primary { background: var(--green); color: #fff; border: none; }
        
        input { background: #0d1117; border: 1px solid var(--border); padding: 12px; color: #fff; border-radius: 6px; width: 100%; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--cyan); }

        .ticker-list { overflow-y: auto; flex-grow: 1; }
        .ticker { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border); cursor: pointer; }
        .active-t { border-left: 3px solid var(--cyan); background: #1c2128; }
        canvas { background: #010409; flex-grow: 1; border: 1px solid var(--border); border-radius: 6px; }

        .stat-big { font-size: 24px; font-weight: 600; }
        .mode-tab { flex: 1; text-align: center; padding: 8px; cursor: pointer; border-bottom: 2px solid transparent; color: #8b949e; font-weight: 600; }
        .active-tab { color: var(--cyan); border-bottom-color: var(--cyan); }
    </style></head><body>

    <div id="adminPanel">
        <div class="admin-title">OVERRIDE_CONSOLE</div>
        <div class="admin-row">
            <span class="admin-label">SET TOTAL CASH</span>
            <input type="number" id="adminCash" placeholder="Enter Amount">
            <button class="btn" onclick="adminSetCash()">APPLY FUNDS</button>
        </div>
        <div class="admin-row">
            <span class="admin-label">TICK SPEED (ms) - Lower is faster</span>
            <input type="number" id="adminSpeed" value="1000">
            <button class="btn" onclick="adminSetSpeed()">UPDATE CLOCK</button>
        </div>
        <div class="admin-row">
            <button class="btn" id="crazyBtn" style="color:var(--red); border-color:var(--red)" onclick="toggleCrazyMode()">ACTIVATE CRAZY_MODE: OFF</button>
        </div>
        <p style="font-size: 9px; color: #484f58; text-align: center;">Press CTRL + ` to close</p>
    </div>

    <div id="authScreen" class="auth-overlay">
        <div class="auth-card">
            <h2 style="text-align:center; margin-bottom:20px; color:var(--cyan)">QA_CORE_AUTH</h2>
            <div class="auth-tabs">
                <div id="loginTab" class="tab active" onclick="setAuthMode('login')">LOGIN</div>
                <div id="signupTab" class="tab" onclick="setAuthMode('signup')">SIGN UP</div>
            </div>
            <input type="text" id="username" placeholder="Terminal ID">
            <input type="password" id="password" placeholder="Access Key">
            <button id="authBtn" class="btn btn-primary" onclick="handleAuth()">INITIALIZE SESSION</button>
            <button class="btn" style="font-size:10px; margin-top: 10px;" onclick="importData()">IMPORT SYNC STRING</button>
            <p id="authError" style="color:var(--red); font-size:11px; margin-top:10px; text-align:center;"></p>
        </div>
    </div>

    <div id="mainHub" class="auth-overlay" style="display:none; z-index:1500;">
        <div class="auth-card" style="width: 500px;">
            <h3>Terminal Connected</h3>
            <span id="hubUser" style="color:var(--magenta)"></span>
            <button class="btn btn-primary" style="padding:15px; margin-top: 20px;" onclick="enterGame()">ENTER MARKET</button>
        </div>
    </div>

    <div class="app" id="app">
        <header class="box" style="grid-column: span 3; flex-direction: row; align-items: center; justify-content: space-between;">
            <div style="font-weight: bold; font-size: 16px;"><span style="color:var(--cyan)">QA</span>_TERMINAL</div>
            <span id="cashDisp" class="stat-big" style="color:var(--green)">$0</span>
        </header>
        <aside class="box"><div class="ticker-list" id="stockList"></div></aside>
        <main class="box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px;">
                <h2 id="sName">--</h2>
                <div id="sPrice" class="stat-big">$0.00</div>
            </div>
            <canvas id="chart"></canvas>
        </main>
        <aside class="box">
            <div style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 15px;">
                <div id="tabDay" class="mode-tab active-tab" onclick="setMode('day')">DAY_TRADE</div>
                <div id="tabInv" class="mode-tab" onclick="setMode('inv')">INVESTOR</div>
            </div>
            <div id="pnlDisp" style="font-size: 24px; font-weight: bold;">$0.00</div>
            <div id="qtyDisp" style="color: #8b949e; margin-bottom: 20px;">Units: 0</div>
            <button class="btn" style="background:var(--green); color:white" onclick="trade(1)">Buy</button>
            <button class="btn" style="background:var(--red); color:white" onclick="trade(-1)">Sell</button>
            <input type="number" id="tradeQty" value="1">
            <div style="margin-top: auto;">
                <button class="btn" onclick="exportData()">Export Sync</button>
                <button class="btn" onclick="location.reload()">Log Out</button>
            </div>
        </aside>
        <footer class="box" style="grid-column: span 3; flex-direction: row; border: none; background: transparent; justify-content: space-between; color: #484f58; font-size: 11px;">
            <div id="status">System Online</div>
            <div id="clock">00:00:00</div>
        </footer>
    </div>

    <script>
        let currentAuthMode = 'login', currentUser = null, tickInterval = null;
        let crazyMode = false, currentSpeed = 1000;
        const Game = { cash: 10000, port: {}, mode: 'day', active: null };
        const Stocks = [];
        const cvs = document.getElementById('chart'), ctx = cvs.getContext('2d');

        // --- ADMIN LOGIC ---
        window.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === '`') {
                e.preventDefault();
                const panel = document.getElementById('adminPanel');
                panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            }
        });

        function adminSetCash() {
            const val = parseFloat(document.getElementById('adminCash').value);
            if (!isNaN(val)) { Game.cash = val; updateUI(); saveGame(); }
        }

        function adminSetSpeed() {
            const val = parseInt(document.getElementById('adminSpeed').value);
            if (!isNaN(val) && val > 10) {
                currentSpeed = val;
                clearInterval(tickInterval);
                tickInterval = setInterval(tick, currentSpeed);
            }
        }

        function toggleCrazyMode() {
            crazyMode = !crazyMode;
            document.getElementById('crazyBtn').innerText = `ACTIVATE CRAZY_MODE: ${crazyMode ? 'ON' : 'OFF'}`;
            document.getElementById('status').innerText = crazyMode ? "SYSTEM_CRITICAL: OVERRIDE ACTIVE" : "System Online";
            document.getElementById('status').style.color = crazyMode ? "var(--red)" : "#484f58";
        }

        // --- CORE ENGINE ---
        function setAuthMode(m) {
            currentAuthMode = m;
            document.getElementById('loginTab').classList.toggle('active', m==='login');
            document.getElementById('signupTab').classList.toggle('active', m==='signup');
        }

        function handleAuth() {
            const u = document.getElementById('username').value.trim(), p = document.getElementById('password').value.trim();
            if(!u || !p) return;
            let registry = JSON.parse(localStorage.getItem('QA_REGISTRY') || '{}');
            if(currentAuthMode === 'signup') {
                registry[u] = { password: p, cash: 10000, port: {} };
                localStorage.setItem('QA_REGISTRY', JSON.stringify(registry));
                alert("Identity Created.");
            } else {
                if(!registry[u] || registry[u].password !== p) return;
                currentUser = u; Game.cash = registry[u].cash; Game.port = registry[u].port;
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainHub').style.display = 'flex';
                document.getElementById('hubUser').innerText = "@" + u;
                generateMarket();
            }
        }

        function enterGame() {
            document.getElementById('mainHub').style.display = 'none';
            document.getElementById('app').style.visibility = 'visible';
            viewStock(Stocks[0].sym);
            tickInterval = setInterval(tick, currentSpeed);
            resize();
        }

        function generateMarket() {
            const assets = [{n:"Bitcoin", s:"BTC", p:64000}, {n:"Apple", s:"AAPL", p:190}, {n:"Nvidia", s:"NVDA", p:800}, {n:"Tesla", s:"TSLA", p:170}];
            assets.forEach(d => Stocks.push({ name: d.n, sym: d.s, price: d.p, vol: 0.02, hist: [] }));
            const list = document.getElementById('stockList');
            Stocks.forEach(x => {
                list.innerHTML += `<div class="ticker" id="tk-${x.sym}" onclick="viewStock('${x.sym}')">
                    <span><b>${x.sym}</b></span><span id="p-${x.sym}">$0.00</span>
                </div>`;
            });
        }

        function viewStock(sym) {
            Game.active = Stocks.find(x => x.sym === sym);
            document.querySelectorAll('.ticker').forEach(e => e.classList.remove('active-t'));
            document.getElementById('tk-'+sym).classList.add('active-t');
            document.getElementById('sName').innerText = Game.active.name;
        }

        function tick() {
            Stocks.forEach(s => {
                let open = s.price;
                // If Crazy Mode is on, volatility jumps from 2% to 15%
                let multiplier = crazyMode ? 0.15 : 0.02;
                s.price += s.price * (Math.random() - 0.5) * multiplier;
                if(s.price < 0.01) s.price = 0.01;
                s.hist.push({o: open, c: s.price, h: Math.max(open, s.price), l: Math.min(open, s.price)});
                if(s.hist.length > 50) s.hist.shift();
                document.getElementById(`p-${s.sym}`).innerText = `$${s.price.toFixed(2)}`;
            });
            draw(); updateUI();
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }

        function draw() {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            const h = Game.active.hist; if(h.length < 2) return;
            const min = Math.min(...h.map(x=>x.l))*0.99, max = Math.max(...h.map(x=>x.h))*1.01, range = max-min;
            const w = cvs.width / 50;
            h.forEach((d, i) => {
                const x = i * w + (w/2), yO = cvs.height - ((d.o-min)/range * cvs.height), yC = cvs.height - ((d.c-min)/range * cvs.height);
                ctx.fillStyle = d.c >= d.o ? '#3fb950' : '#f85149';
                ctx.fillRect(i*w + 4, Math.min(yO, yC), w-8, Math.max(Math.abs(yO-yC), 1));
            });
        }

        function trade(dir) {
            const s = Game.active, qty = parseInt(document.getElementById('tradeQty').value);
            if(!Game.port[s.sym]) Game.port[s.sym] = { qty: 0, avg: 0 };
            const p = Game.port[s.sym];
            if(dir === 1 && Game.cash >= s.price * qty) {
                Game.cash -= s.price * qty;
                p.avg = (p.qty*p.avg + s.price*qty) / (p.qty + qty);
                p.qty += qty;
            } else if(dir === -1 && p.qty >= qty) {
                Game.cash += s.price * qty;
                p.qty -= qty;
            }
            saveGame(); updateUI();
        }

        function updateUI() {
            document.getElementById('cashDisp').innerText = `$${Math.floor(Game.cash).toLocaleString()}`;
            document.getElementById('sPrice').innerText = `$${Game.active.price.toFixed(2)}`;
            const p = Game.port[Game.active.sym];
            document.getElementById('qtyDisp').innerText = `Units: ${p ? p.qty : 0}`;
        }

        function saveGame() {
            let registry = JSON.parse(localStorage.getItem('QA_REGISTRY'));
            if(registry && currentUser) {
                registry[currentUser].cash = Game.cash;
                registry[currentUser].port = Game.port;
                localStorage.setItem('QA_REGISTRY', JSON.stringify(registry));
            }
        }

        function exportData() {
            let data = btoa(localStorage.getItem('QA_REGISTRY'));
            navigator.clipboard.writeText(data); alert("Sync String Copied!");
        }

        function importData() {
            let s = prompt("Paste String:");
            if(s) { localStorage.setItem('QA_REGISTRY', atob(s)); alert("Synced!"); }
        }

        function resize() { cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight; }
        window.onresize = resize;
        function setMode(m) { Game.mode = m; }
    </script></body></html>
